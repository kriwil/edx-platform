tinymce.PluginManager.requireLangPack("codemirror"),tinymce.PluginManager.add("codemirror",function(e,t){function n(){e.focus(),e.selection.collapse(!0),e.selection.setContent('<span class="CmCaReT" style="display:none">&#0;</span>');var n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)}),o=void 0,i="?CodeMirrorPath="+e.settings.codemirror.path+"&ParentOrigin="+window.location.origin+"&GUID="+n,a=e.windowManager.open({title:"HTML source code",url:t+"/source.html"+i,width:800,height:550,resizable:!0,maximizable:!0,buttons:[{text:"OK",subtype:"primary",onclick:function(){c({type:"save"})}},{text:"Cancel",onclick:function(){c({type:"cancel"})}}]}),r=a.getEl().getElementsByTagName("iframe")[0].contentWindow,c=function(e){r.postMessage(e,o)},s=function(t){if(o){if(o!==t.origin)return}else{if(t.data.guid!==n)return;o=t.origin}var i;if("init"===t.data.type)i={content:e.getContent({source_view:!0})},e.fire("ShowCodeEditor",i),c({type:"init",content:i.content}),e.dom.remove(e.dom.select(".CmCaReT"));else if("setText"===t.data.type){i={content:t.data.text};var r=t.data.isDirty;e.fire("SaveCodeEditor",i),e.setContent(i.content);var s=e.dom.select("span#CmCaReT")[0];if(s)e.selection.scrollIntoView(s),e.selection.setCursorLocation(s,0),e.dom.remove(s);else{var d=e.getContent(),l=d.replace('<span id="CmCaReT"></span>',"");d!==l&&e.setContent(l)}e.isNotDirty=!r,r&&e.nodeChanged()}else"closeWindow"===t.data.type&&a.close()};a.on("close",function(){window.removeEventListener("message",s)}),window.addEventListener("message",s,!1)}e.addButton("code",{title:"Edit HTML",text:"HTML",icon:!1,onclick:n}),e.addMenuItem("code",{icon:"code",text:"Edit HTML",context:"tools",onclick:n})});